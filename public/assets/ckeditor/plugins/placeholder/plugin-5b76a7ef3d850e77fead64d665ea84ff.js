/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){var e=/\[\[[^\]]+\]\]/g;CKEDITOR.plugins.add("placeholder",{requires:["dialog"],lang:["bg","cs","cy","da","de","el","en","eo","et","fa","fi","fr","he","hr","it","nb","nl","no","pl","pt-br","tr","ug","uk","vi","zh-cn"],init:function(e){var t=e.lang.placeholder;e.addCommand("createplaceholder",new CKEDITOR.dialogCommand("createplaceholder")),e.addCommand("editplaceholder",new CKEDITOR.dialogCommand("editplaceholder")),e.ui.addButton("CreatePlaceholder",{label:t.toolbar,command:"createplaceholder",icon:this.path+"placeholder.gif"}),e.addMenuItems&&(e.addMenuGroup("placeholder",20),e.addMenuItems({editplaceholder:{label:t.edit,command:"editplaceholder",group:"placeholder",order:1,icon:this.path+"placeholder.gif"}}),e.contextMenu&&e.contextMenu.addListener(function(e,t){return!e||!e.data("cke-placeholder")?null:{editplaceholder:CKEDITOR.TRISTATE_OFF}})),e.on("doubleclick",function(t){CKEDITOR.plugins.placeholder.getSelectedPlaceHoder(e)&&(t.data.dialog="editplaceholder")}),e.addCss(".cke_placeholder{background-color: #ffff00;"+(CKEDITOR.env.gecko?"cursor: default;":"")+"}"),e.on("contentDom",function(){e.document.getBody().on("resizestart",function(t){e.getSelection().getSelectedElement().data("cke-placeholder")&&t.data.preventDefault()})}),CKEDITOR.dialog.add("createplaceholder",this.path+"dialogs/placeholder.js"),CKEDITOR.dialog.add("editplaceholder",this.path+"dialogs/placeholder.js")},afterInit:function(t){var n=t.dataProcessor,r=n&&n.dataFilter,i=n&&n.htmlFilter;r&&r.addRules({text:function(n){return n.replace(e,function(e){return CKEDITOR.plugins.placeholder.createPlaceholder(t,null,e,1)})}}),i&&i.addRules({elements:{span:function(e){e.attributes&&e.attributes["data-cke-placeholder"]&&delete e.name}}})}})})(),CKEDITOR.plugins.placeholder={createPlaceholder:function(e,t,n,r){var i=new CKEDITOR.dom.element("span",e.document);return i.setAttributes({contentEditable:"false","data-cke-placeholder":1,"class":"cke_placeholder"}),n&&i.setText(n),r?i.getOuterHtml():(t?CKEDITOR.env.ie?(i.insertAfter(t),setTimeout(function(){t.remove(),i.focus()},10)):i.replace(t):e.insertElement(i),null)},getSelectedPlaceHoder:function(e){var t=e.getSelection().getRanges()[0];t.shrink(CKEDITOR.SHRINK_TEXT);var n=t.startContainer;while(n&&(n.type!=CKEDITOR.NODE_ELEMENT||!n.data("cke-placeholder")))n=n.getParent();return n}};